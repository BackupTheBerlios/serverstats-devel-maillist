<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Serverstats-devel] r159 - in branches/xmlconfig2: ajax ajax/css config.sample config.sample/xml includes sources
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/serverstats-devel/2006-July/index.html" >
   <LINK REL="made" HREF="mailto:serverstats-devel%40lists.berlios.de?Subject=Re%3A%20%5BServerstats-devel%5D%20r159%20-%20in%20branches/xmlconfig2%3A%20ajax%20ajax/css%20config.sample%20config.sample/xml%20includes%20sources&In-Reply-To=%3C200607032356.k63NuoBC009946%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000124.html">
   <LINK REL="Next"  HREF="000125.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Serverstats-devel] r159 - in branches/xmlconfig2: ajax ajax/css config.sample config.sample/xml includes sources</H1>
    <B>scramatte at berlios.de</B> 
    <A HREF="mailto:serverstats-devel%40lists.berlios.de?Subject=Re%3A%20%5BServerstats-devel%5D%20r159%20-%20in%20branches/xmlconfig2%3A%20ajax%20ajax/css%20config.sample%20config.sample/xml%20includes%20sources&In-Reply-To=%3C200607032356.k63NuoBC009946%40sheep.berlios.de%3E"
       TITLE="[Serverstats-devel] r159 - in branches/xmlconfig2: ajax ajax/css config.sample config.sample/xml includes sources">scramatte at berlios.de
       </A><BR>
    <I>Tue Jul  4 01:56:50 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000124.html">[Serverstats-devel] How can I use same graph  definition with many sources
</A></li>
        <LI>Next message: <A HREF="000125.html">[Serverstats-devel] r160 - in branches/xmlconfig2/config.sample/xml: . templates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#120">[ date ]</a>
              <a href="thread.html#120">[ thread ]</a>
              <a href="subject.html#120">[ subject ]</a>
              <a href="author.html#120">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: scramatte
Date: 2006-07-04 01:56:30 +0200 (Tue, 04 Jul 2006)
New Revision: 159

Added:
   branches/xmlconfig2/config.sample/xml/config.xml
   branches/xmlconfig2/config.sample/xml/graphs.xml
Modified:
   branches/xmlconfig2/ajax/css/style.css
   branches/xmlconfig2/ajax/tree.xml
   branches/xmlconfig2/config.sample/graph.php
   branches/xmlconfig2/config.sample/sources.php
   branches/xmlconfig2/config.sample/xml.php
   branches/xmlconfig2/config.sample/xml/sources.xml
   branches/xmlconfig2/includes/xmlconfig.class.php
   branches/xmlconfig2/sources/snmp.php
Log:
Implementing xmlconfing


Modified: branches/xmlconfig2/ajax/css/style.css
===================================================================
--- branches/xmlconfig2/ajax/css/style.css	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/ajax/css/style.css	2006-07-03 23:56:30 UTC (rev 159)
@@ -62,8 +62,11 @@
 }
 
 #footer {
-        border: 1px solid #cccccc;
-        height: 50px;
+	background: #000000;
+	color: #ffffff;
+	font-size: 10px;
+        height: 20px;
+	padding: 5px;
 }
 
 .progress {

Modified: branches/xmlconfig2/ajax/tree.xml
===================================================================
--- branches/xmlconfig2/ajax/tree.xml	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/ajax/tree.xml	2006-07-03 23:56:30 UTC (rev 159)
@@ -1,10 +1,10 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
 &lt;node xmlns=&quot;urn:serverstats&quot; xmlns:xi=&quot;<A HREF="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</A>&quot; xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;&gt;
 	&lt;title&gt;Zone 1&lt;/title&gt;
-	&lt;filter /&gt;
+	&lt;filter&gt;none&lt;/filter&gt;
 	&lt;node&gt;
 		&lt;title&gt;Zone 2&lt;/title&gt;
-		&lt;filter /&gt;
+		&lt;filter&gt;groupby:vps&lt;/filter&gt;
 	&lt;/node&gt;
 &lt;/node&gt;
 

Modified: branches/xmlconfig2/config.sample/graph.php
===================================================================
--- branches/xmlconfig2/config.sample/graph.php	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/config.sample/graph.php	2006-07-03 23:56:30 UTC (rev 159)
@@ -30,10 +30,10 @@
 
 // List of all Graphs
 $config['list'] = array();
-
 // Add graphs using the simple configuration
 // (To change what graphs are generated by simpleconfig please edit simple.php)
-simpleconfig::graph($config, $rootConfig['simple']);
+//simpleconfig::graph($config, $rootConfig['simple']);
+xmlconfig::graph($config, $rootConfig['xml']);
 
 $config['tree'] = array(
 	'title' =&gt; 'All graphs',
@@ -49,485 +49,21 @@
 		),
 		array ( 
 			'title' =&gt; 'datacenter1',
+			'filter' =&gt; 'none',
 			'sub' =&gt; array (
 				array ( 
 					'title' =&gt; 'switches',
 					'filter' =&gt; 'groupby:switches1'
 					
+				), 
+				array (
+					'title' =&gt; 'VPS',
+					'filter' =&gt; 'groupby:vps'
 				)
 			)
-		)	
-	)
-);
-
-// Add own graphs (examples, like those used in the simple-config)
-
-$config['list'][] = array(
-	'title' =&gt; 'Users logged in',
-	'lowerLimit' =&gt; 0,
-	'altAutoscaleMax' =&gt; true,
-	'content' =&gt; array(
-		array(
-			'type' =&gt; 'AREA',
-			'source' =&gt; 'users',
-			'ds' =&gt; 'users',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'users logged in',
-			'color' =&gt; '4444DD'
 		)
 	)
 );
-$config['list'][] = array(
-	'title' =&gt; 'Load',
-	'lowerLimit' =&gt; 0,
-	'altAutoscaleMax' =&gt; true,
-	'categories' =&gt; array (
-		'host'=&gt; '127.0.0.1',
-		'impact' =&gt; 'important',
-		'groupby' =&gt; 'switches1'
-	),
-	'content' =&gt; array(
-		array(
-			'type' =&gt; 'COMMENT',
-			'text' =&gt; 'average number of tasks in the queue\:\n'
-		),
-		array(
-			'type' =&gt; 'LINE',
-			'source' =&gt; 'load',
-			'ds' =&gt; '1min',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; '1 minute',
-			'width' =&gt; 1,
-			'color' =&gt; 'FFDD00'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_1min',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; '  cur\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_1min',
-			'cf' =&gt; 'MAXIMUM',
-			'format' =&gt; 'max\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_1min',
-			'cf' =&gt; 'MINIMUM',
-			'format' =&gt; 'min\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_1min',
-			'cf' =&gt; 'AVERAGE',
-			'format' =&gt; 'avg\: %01.2lf\n'
-		),
-		array(
-			'type' =&gt; 'LINE',
-			'source' =&gt; 'load',
-			'ds' =&gt; '5min',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; '5 minutes',
-			'width' =&gt; 1,
-			'color' =&gt; 'FF8800'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_5min',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; ' cur\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_5min',
-			'cf' =&gt; 'MAXIMUM',
-			'format' =&gt; 'max\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_5min',
-			'cf' =&gt; 'MINIMUM',
-			'format' =&gt; 'min\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_5min',
-			'cf' =&gt; 'AVERAGE',
-			'format' =&gt; 'avg\: %01.2lf\n'
-		),
-		array(
-			'type' =&gt; 'LINE',
-			'source' =&gt; 'load',
-			'ds' =&gt; '15min',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; '15 minutes',
-			'width' =&gt; 1,
-			'color' =&gt; 'FF0000'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_15min',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; 'cur\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_15min',
-			'cf' =&gt; 'MAXIMUM',
-			'format' =&gt; 'max\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_15min',
-			'cf' =&gt; 'MINIMUM',
-			'format' =&gt; 'min\: %01.2lf'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'load_15min',
-			'cf' =&gt; 'AVERAGE',
-			'format' =&gt; 'avg\: %01.2lf\n'
-		)
-	)
-);
-$config['list'][] = array(
-	'title' =&gt; 'Memory',
-	'lowerLimit' =&gt; 0,
-	'altAutoscaleMax' =&gt; true,
-	'content' =&gt; array(
-		array(
-			'type' =&gt; 'DEF',
-			'source' =&gt; 'mem',
-			'ds' =&gt; 'MemTotal',
-			'cf' =&gt; 'AVERAGE',
-			'name' =&gt; 'total'
-		),
-		array(
-			'type' =&gt; 'CDEF',
-			'expression' =&gt; 'total,1024,/,1024,/',
-			'name' =&gt; 'total_mb'
-		),
-		array(
-			'type' =&gt; 'DEF',
-			'source' =&gt; 'mem',
-			'ds' =&gt; 'MemFree',
-			'cf' =&gt; 'AVERAGE',
-			'name' =&gt; 'free'
-		),
-		array(
-			'type' =&gt; 'CDEF',
-			'expression' =&gt; 'free,1024,/,1024,/',
-			'name' =&gt; 'free_mb'
-		),
-		array(
-			'type' =&gt; 'DEF',
-			'source' =&gt; 'mem',
-			'ds' =&gt; 'Cached',
-			'cf' =&gt; 'AVERAGE',
-			'name' =&gt; 'cached'
-		),
-		array(
-			'type' =&gt; 'CDEF',
-			'expression' =&gt; 'cached,1024,/,1024,/',
-			'name' =&gt; 'cached_mb'
-		),
-		array(
-			'type' =&gt; 'AREA',
-			'name' =&gt; 'total',
-			'legend' =&gt; 'total',
-			'color' =&gt; 'FFFFCC'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'total_mb',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; ' cur\: %01.2lf MB\n'
-		),
-		array(
-			'type' =&gt; 'AREA',
-			'name' =&gt; 'free',
-			'legend' =&gt; 'free',
-			'color' =&gt; 'FF0000'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'free_mb',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; '   cur\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'free_mb',
-			'cf' =&gt; 'MINIMUM',
-			'format' =&gt; 'min\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'free_mb',
-			'cf' =&gt; 'MAXIMUM',
-			'format' =&gt; 'max\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'free_mb',
-			'cf' =&gt; 'AVERAGE',
-			'format' =&gt; 'avg\: %01.2lf MB\n'
-		),
-		array(
-			'type' =&gt; 'STACK',
-			'name' =&gt; 'cached',
-			'legend' =&gt; 'cached',
-			'color' =&gt; 'EEDD22'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'cached_mb',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; 'cur\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'cached_mb',
-			'cf' =&gt; 'MINIMUM',
-			'format' =&gt; 'min\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'cached_mb',
-			'cf' =&gt; 'MAXIMUM',
-			'format' =&gt; 'max\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'cached_mb',
-			'cf' =&gt; 'AVERAGE',
-			'format' =&gt; 'avg\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'LINE',
-			'width' =&gt; 1,
-			'name' =&gt; 'total',
-			'color' =&gt; '000000'
-		)
-	)
-);
-$config['list'][] = array(
-	'title' =&gt; 'Swap',
-	'lowerLimit' =&gt; 0,
-	'altAutoscaleMax' =&gt; true,
-	'content' =&gt; array(
-		array(
-			'type' =&gt; 'DEF',
-			'source' =&gt; 'mem',
-			'ds' =&gt; 'SwapTotal',
-			'cf' =&gt; 'AVERAGE',
-			'name' =&gt; 'total'
-		),
-		array(
-			'type' =&gt; 'CDEF',
-			'expression' =&gt; 'total,1024,/,1024,/',
-			'name' =&gt; 'total_mb'
-		),
-		array(
-			'type' =&gt; 'DEF',
-			'source' =&gt; 'mem',
-			'ds' =&gt; 'SwapFree',
-			'cf' =&gt; 'AVERAGE',
-			'name' =&gt; 'free'
-		),
-		array(
-			'type' =&gt; 'CDEF',
-			'expression' =&gt; 'free,1024,/,1024,/',
-			'name' =&gt; 'free_mb'
-		),
-		array(
-			'type' =&gt; 'DEF',
-			'source' =&gt; 'mem',
-			'ds' =&gt; 'SwapCached',
-			'cf' =&gt; 'AVERAGE',
-			'name' =&gt; 'cached'
-		),
-		array(
-			'type' =&gt; 'CDEF',
-			'expression' =&gt; 'cached,1024,/,1024,/',
-			'name' =&gt; 'cached_mb'
-		),
-		array(
-			'type' =&gt; 'AREA',
-			'name' =&gt; 'total',
-			'legend' =&gt; 'total',
-			'color' =&gt; 'FFFFCC'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'total_mb',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; ' cur\: %01.2lf MB\n'
-		),
-		array(
-			'type' =&gt; 'AREA',
-			'name' =&gt; 'free',
-			'legend' =&gt; 'free',
-			'color' =&gt; 'FF0000'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'free_mb',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; '   cur\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'free_mb',
-			'cf' =&gt; 'MINIMUM',
-			'format' =&gt; 'min\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'free_mb',
-			'cf' =&gt; 'MAXIMUM',
-			'format' =&gt; 'max\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'free_mb',
-			'cf' =&gt; 'AVERAGE',
-			'format' =&gt; 'avg\: %01.2lf MB\n'
-		),
-		array(
-			'type' =&gt; 'STACK',
-			'name' =&gt; 'cached',
-			'legend' =&gt; 'cached',
-			'color' =&gt; 'EEDD22'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'cached_mb',
-			'cf' =&gt; 'LAST',
-			'format' =&gt; 'cur\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'cached_mb',
-			'cf' =&gt; 'MINIMUM',
-			'format' =&gt; 'min\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'cached_mb',
-			'cf' =&gt; 'MAXIMUM',
-			'format' =&gt; 'max\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'GPRINT',
-			'name' =&gt; 'cached_mb',
-			'cf' =&gt; 'AVERAGE',
-			'format' =&gt; 'avg\: %01.2lf MB'
-		),
-		array(
-			'type' =&gt; 'LINE',
-			'width' =&gt; 1,
-			'name' =&gt; 'total',
-			'color' =&gt; '000000'
-		)
-	)
-);
-$config['list'][] = array(
-	'title' =&gt; 'CPU usage',
-	'upperLimit' =&gt; 100,
-	'lowerLimit' =&gt; 0,
-	'altAutoscaleMax' =&gt; true,
-	'content' =&gt; array(
-		array(
-			'type' =&gt; 'AREA',
-			'source' =&gt; 'cpu',
-			'ds' =&gt; 'cpu_system',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'System',
-			'color' =&gt; 'FF0000'
-		),
-		array(
-			'type' =&gt; 'AREA',
-			'source' =&gt; 'cpu',
-			'ds' =&gt; 'cpu_user',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'User',
-			'color' =&gt; '00FF00',
-			'stacked' =&gt; true
-		),
-		array(
-			'type' =&gt; 'AREA',
-			'source' =&gt; 'cpu',
-			'ds' =&gt; 'cpu_nice',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'Nice',
-			'color' =&gt; '0000FF',
-			'stacked' =&gt; true
-		),
-		array(
-			'type' =&gt; 'AREA',
-			'source' =&gt; 'cpu',
-			'ds' =&gt; 'cpu_idle',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'Idle',
-			'color' =&gt; 'FFFF00',
-			'stacked' =&gt; true
-		)
-	)
-);
-$config['list'][] = array(
-	'title' =&gt; 'Processes',
-	'lowerLimit' =&gt; 0,
-	'altAutoscaleMax' =&gt; true,
-	'content' =&gt; array(
-		array(
-			'type' =&gt; 'AREA',
-			'source' =&gt; 'load',
-			'ds' =&gt; 'tasks',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'number of processes',
-			'color' =&gt; 'FFDD00'
-		),
-		array(
-			'type' =&gt; 'AREA',
-			'source' =&gt; 'load',
-			'ds' =&gt; 'running',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'running processes',
-			'color' =&gt; 'FF0000'
-		)
-	)
-);
-$config['list'][] = array(
-	'title' =&gt; 'Traffic (eth0)',
-	'lowerLimit' =&gt; 0,
-	'altAutoscaleMax' =&gt; true,
-	'content' =&gt; array(
-		array(
-			'type' =&gt; 'LINE',
-			'source' =&gt; 'traffic_proc',
-			'ds' =&gt; 'eth0_rbytes',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'Download Bytes/s',
-			'width' =&gt; 1,
-			'color' =&gt; '0002A3'
-		),
-		array(
-			'type' =&gt; 'LINE',
-			'source' =&gt; 'traffic_proc',
-			'ds' =&gt; 'eth0_tbytes',
-			'cf' =&gt; 'AVERAGE',
-			'legend' =&gt; 'Upload Bytes/s',
-			'width' =&gt; 1,
-			'color' =&gt; '00A302'
-		)
-	)
-);
-
-
-// Define what Graphes we want in the detail view (detail.php)
 $config['types'] = array(
 //	array('title' =&gt; 'Hour', 'period' =&gt; 3600), // only useful if you have a small step
 	array('title' =&gt; 'Day', 'period' =&gt; 86400),

Modified: branches/xmlconfig2/config.sample/sources.php
===================================================================
--- branches/xmlconfig2/config.sample/sources.php	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/config.sample/sources.php	2006-07-03 23:56:30 UTC (rev 159)
@@ -27,7 +27,7 @@
 
 // Add sources using the simple configuration
 // (To change what sources are used by simpleconfig please edit simple.php)
-simpleconfig::sources($config, $rootConfig['simple']);
+// simpleconfig::sources($config, $rootConfig['simple']);
 xmlconfig::sources($config, $rootConfig['xml']);
 
 // Add own sources (examples, like those used in the simple-config)

Added: branches/xmlconfig2/config.sample/xml/config.xml
===================================================================
--- branches/xmlconfig2/config.sample/xml/config.xml	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/config.sample/xml/config.xml	2006-07-03 23:56:30 UTC (rev 159)
@@ -0,0 +1,5 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
+&lt;config xmlns=&quot;urn:serverstats&quot; xmlns:xi=&quot;<A HREF="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</A>&quot; xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;  &gt;
+	&lt;xi:include href=&quot;sources.xml&quot; /&gt;
+	&lt;xi:include href=&quot;graphs.xml&quot; /&gt;
+&lt;/config&gt;

Added: branches/xmlconfig2/config.sample/xml/graphs.xml
===================================================================
--- branches/xmlconfig2/config.sample/xml/graphs.xml	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/config.sample/xml/graphs.xml	2006-07-03 23:56:30 UTC (rev 159)
@@ -0,0 +1,122 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
+&lt;graphs xmlns=&quot;urn:serverstats&quot; xmlns:xi=&quot;<A HREF="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</A>&quot; xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;  &gt;
+	&lt;graph&gt;
+			 &lt;param name=&quot;title&quot;&gt;Load SNMP&lt;/param&gt;
+                                &lt;param name=&quot;lowerLimit&quot;&gt;0&lt;/param&gt;
+                                &lt;param name=&quot;altAutoscaleMax&quot;&gt;true&lt;/param&gt;
+				&lt;param name=&quot;categories&quot; xsi:type=&quot;xsd:array&quot;&gt;
+					&lt;param name=&quot;title&quot;&gt;vps&lt;/param&gt;
+					&lt;param name=&quot;groupby&quot;&gt;vps&lt;/param&gt;
+					&lt;param name=&quot;impact&quot;&gt;important&lt;/param&gt;
+				&lt;/param&gt;
+                                &lt;param name=&quot;content&quot; xsi:type=&quot;xsd:array&quot;&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;COMMENT&lt;/param&gt;
+                                                        &lt;param name=&quot;text&quot;&gt;average number of tasks in the queue\:\n&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;LINE&lt;/param&gt;
+                                                        &lt;param name=&quot;source&quot;&gt;snmp1&lt;/param&gt;
+                                                        &lt;param name=&quot;ds&quot;&gt;1min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;AVERAGE&lt;/param&gt;
+                                                        &lt;param name=&quot;legend&quot;&gt;1 minute&lt;/param&gt;
+                                                        &lt;param name=&quot;width&quot;&gt;1&lt;/param&gt;
+                                                        &lt;param name=&quot;color&quot;&gt;FFDD00&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_1min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;LAST&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  cur\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_1min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;MAXIMUM&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  max\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_1min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;MINIMUM&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  min\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_1min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;AVERAGE&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  avg\: %01.2lf\n&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;LINE&lt;/param&gt;
+                                                        &lt;param name=&quot;source&quot;&gt;snmp1&lt;/param&gt;
+                                                        &lt;param name=&quot;ds&quot;&gt;5min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;AVERAGE&lt;/param&gt;
+                                                        &lt;param name=&quot;legend&quot;&gt;5 minutes&lt;/param&gt;
+                                                        &lt;param name=&quot;width&quot;&gt;1&lt;/param&gt;
+                                                        &lt;param name=&quot;color&quot;&gt;FF8800&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_5min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;LAST&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  cur\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_5min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;MAXIMUM&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  max\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_5min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;MINIMUM&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  min\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_5min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;AVERAGE&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  avg\: %01.2lf\n&lt;/param&gt;
+                                                &lt;/param&gt;
+
+
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;LINE&lt;/param&gt;
+                                                        &lt;param name=&quot;source&quot;&gt;snmp1&lt;/param&gt;
+                                                        &lt;param name=&quot;ds&quot;&gt;15min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;AVERAGE&lt;/param&gt;
+                                                        &lt;param name=&quot;legend&quot;&gt;15 minutes&lt;/param&gt;
+                                                        &lt;param name=&quot;width&quot;&gt;1&lt;/param&gt;
+                                                        &lt;param name=&quot;color&quot;&gt;FF0000&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_15min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;LAST&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  cur\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_15min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;MAXIMUM&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  max\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_15min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;MINIMUM&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  min\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+                                                &lt;param xsi:type=&quot;xsd:array&quot;&gt;
+                                                        &lt;param name=&quot;type&quot;&gt;GPRINT&lt;/param&gt;
+                                                        &lt;param name=&quot;name&quot;&gt;snmp1_15min&lt;/param&gt;
+                                                        &lt;param name=&quot;cf&quot;&gt;AVERAGE&lt;/param&gt;
+                                                        &lt;param name=&quot;format&quot;&gt;  avg\: %01.2lf&lt;/param&gt;
+                                                &lt;/param&gt;
+
+                                &lt;/param&gt;
+
+	&lt;/graph&gt;
+&lt;/graphs&gt;

Modified: branches/xmlconfig2/config.sample/xml/sources.xml
===================================================================
--- branches/xmlconfig2/config.sample/xml/sources.xml	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/config.sample/xml/sources.xml	2006-07-03 23:56:30 UTC (rev 159)
@@ -1,4 +1,13 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
 &lt;sources xmlns=&quot;urn:serverstats&quot; xmlns:xi=&quot;<A HREF="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</A>&quot; xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;  &gt;
 	&lt;source type=&quot;cpu&quot; id=&quot;cpu2&quot; /&gt;
+	&lt;source type=&quot;snmp&quot; id=&quot;snmp1&quot;&gt;
+		&lt;param name=&quot;host&quot;&gt;127.0.0.1&lt;/param&gt;
+		&lt;param name=&quot;comunity&quot;&gt;public&lt;/param&gt;
+		&lt;param name=&quot;objects&quot; xsi:type=&quot;xsd:array&quot;&gt;
+			&lt;param name=&quot;1min&quot;&gt;UCD-SNMP-MIB::laLoad.1&lt;/param&gt;
+		        &lt;param name=&quot;5min&quot;&gt;UCD-SNMP-MIB::laLoad.2&lt;/param&gt;
+		        &lt;param name=&quot;15min&quot;&gt;UCD-SNMP-MIB::laLoad.3&lt;/param&gt;
+		&lt;/param&gt;
+	&lt;/source&gt;
 &lt;/sources&gt;

Modified: branches/xmlconfig2/config.sample/xml.php
===================================================================
--- branches/xmlconfig2/config.sample/xml.php	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/config.sample/xml.php	2006-07-03 23:56:30 UTC (rev 159)
@@ -26,11 +26,15 @@
 //$config['used'] = true; // is the simple config used
 
 $dom = new domDocument();
-$dom-&gt;load(CONFIGPATH . 'xml/sources.xml');
+$dom-&gt;load(CONFIGPATH . 'xml/config.xml');
 $dom-&gt;Xinclude();
 
-$config['modules'] = xmlconfig::read($dom);
+
+$xmlconfig = xmlconfig::read($dom);
+//print_r ($xmlconfig);
+
+$config['modules'] = $xmlconfig['modules'];
+$config['graphs'] = $xmlconfig['graphs'];
 $config['used'] = true;
 
-//print_r ($config);
 ?&gt;

Modified: branches/xmlconfig2/includes/xmlconfig.class.php
===================================================================
--- branches/xmlconfig2/includes/xmlconfig.class.php	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/includes/xmlconfig.class.php	2006-07-03 23:56:30 UTC (rev 159)
@@ -14,7 +14,7 @@
   			
   			switch ($child-&gt;nodeName) {
   				case 'graph':
-						self::__traverseParams($child, $config[ $host ]['graphs'][], $host);		
+						self::__traverseParams($child, $config['graphs'][]);		
 						break;
 					case 'source':
 						$id = $child-&gt;getAttribute('id');
@@ -24,8 +24,7 @@
 						self::__traverseParams($child, $args);		
 											
 						if (class_exists($class)) {
-							/*$args['host'] = $host;*/
-							$config[ $id ] = call_user_func(array($class,'factory'), $args); 				
+							$config['modules'][ $id ] = call_user_func(array($class,'factory'), $args); 				
 						}
 						
 												
@@ -44,7 +43,6 @@
 						break;
 
 					default:
-						print ($child-&gt;nodeName);
 						self::__traverseParams($child, $config);		
 						break;
 						
@@ -54,7 +52,21 @@
 	}
 
 
-public static function sources(&amp;$config, $xmlconfig)
+	public static function graph(&amp;$config, $xmlconfig)
+	{
+            if (!$xmlconfig['used'])
+                {
+                        return;
+                }
+
+		foreach ($xmlconfig['graphs'] as $graph =&gt; $graphconf) 
+		{
+			 $config['list'][] = $graphconf;
+		}
+		
+	}
+
+	public static function sources(&amp;$config, $xmlconfig)
         {
                 if (!$xmlconfig['used'])
                 {

Modified: branches/xmlconfig2/sources/snmp.php
===================================================================
--- branches/xmlconfig2/sources/snmp.php	2006-07-03 20:27:05 UTC (rev 158)
+++ branches/xmlconfig2/sources/snmp.php	2006-07-03 23:56:30 UTC (rev 159)
@@ -98,6 +98,10 @@
 		}
 		return $values;
 	}
+
+	public static function factory($args) {
+		return new snmp($args['host'],$args['objects'], $args['comunity']);
+	}
 }
 
 ?&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000124.html">[Serverstats-devel] How can I use same graph  definition with many sources
</A></li>
	<LI>Next message: <A HREF="000125.html">[Serverstats-devel] r160 - in branches/xmlconfig2/config.sample/xml: . templates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#120">[ date ]</a>
              <a href="thread.html#120">[ thread ]</a>
              <a href="subject.html#120">[ subject ]</a>
              <a href="author.html#120">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/serverstats-devel">More information about the Serverstats-devel
mailing list</a><br>
</body></html>
