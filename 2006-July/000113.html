<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Serverstats-devel] r152 - in branches/xmlconfig2: . ajax ajax/css ajax/img ajax/js config.sample
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/serverstats-devel/2006-July/index.html" >
   <LINK REL="made" HREF="mailto:serverstats-devel%40lists.berlios.de?Subject=Re%3A%20%5BServerstats-devel%5D%20r152%20-%20in%20branches/xmlconfig2%3A%20.%20ajax%20ajax/css%20ajax/img%20ajax/js%20config.sample&In-Reply-To=%3C200607031921.k63JLS3x006733%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000112.html">
   <LINK REL="Next"  HREF="000114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Serverstats-devel] r152 - in branches/xmlconfig2: . ajax ajax/css ajax/img ajax/js config.sample</H1>
    <B>scramatte at berlios.de</B> 
    <A HREF="mailto:serverstats-devel%40lists.berlios.de?Subject=Re%3A%20%5BServerstats-devel%5D%20r152%20-%20in%20branches/xmlconfig2%3A%20.%20ajax%20ajax/css%20ajax/img%20ajax/js%20config.sample&In-Reply-To=%3C200607031921.k63JLS3x006733%40sheep.berlios.de%3E"
       TITLE="[Serverstats-devel] r152 - in branches/xmlconfig2: . ajax ajax/css ajax/img ajax/js config.sample">scramatte at berlios.de
       </A><BR>
    <I>Mon Jul  3 21:21:28 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000112.html">[Serverstats-devel] r151 - branches
</A></li>
        <LI>Next message: <A HREF="000114.html">[Serverstats-devel] r153 - in branches/xmlconfig/config.sample/xml: . templates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#113">[ date ]</a>
              <a href="thread.html#113">[ thread ]</a>
              <a href="subject.html#113">[ subject ]</a>
              <a href="author.html#113">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: scramatte
Date: 2006-07-03 21:21:03 +0200 (Mon, 03 Jul 2006)
New Revision: 152

Added:
   branches/xmlconfig2/ajax/
   branches/xmlconfig2/ajax/css/
   branches/xmlconfig2/ajax/css/style.css
   branches/xmlconfig2/ajax/css/tree.css
   branches/xmlconfig2/ajax/detail.php
   branches/xmlconfig2/ajax/graphs.php
   branches/xmlconfig2/ajax/img/
   branches/xmlconfig2/ajax/img/corner.gif
   branches/xmlconfig2/ajax/img/file.gif
   branches/xmlconfig2/ajax/img/folder.gif
   branches/xmlconfig2/ajax/img/indicator_white.gif
   branches/xmlconfig2/ajax/img/minus.gif
   branches/xmlconfig2/ajax/img/plus.gif
   branches/xmlconfig2/ajax/img/vdot.gif
   branches/xmlconfig2/ajax/index.php
   branches/xmlconfig2/ajax/js/
   branches/xmlconfig2/ajax/js/ajax.js
   branches/xmlconfig2/ajax/js/tree.js
   branches/xmlconfig2/ajax/js/xml.js
   branches/xmlconfig2/ajax/tree.php
   branches/xmlconfig2/ajax/tree.xml
   branches/xmlconfig2/ajax/tree.xsl
Modified:
   branches/xmlconfig2/config.sample/graph.php
   branches/xmlconfig2/config.sample/sources.php
   branches/xmlconfig2/init.php
Log:
Add  ajax style view :)


Added: branches/xmlconfig2/ajax/css/style.css
===================================================================
--- branches/xmlconfig2/ajax/css/style.css	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/css/style.css	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,71 @@
+/**
+ * $Id: style.css 123 2006-04-11 12:35:34Z goliath $
+ *
+ * Author: David Danier, <A HREF="https://lists.berlios.de/mailman/listinfo/serverstats-devel">david.danier at team23.de</A>
+ * Project: Serverstats, <A HREF="http://serverstats.berlios.de/">http://serverstats.berlios.de/</A>
+ * License: GPL v2 or later (<A HREF="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</A>)
+ *
+ * Copyright (C) 2005 David Danier
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+body {
+	font-family: verdana, arial, sans-serif;
+	padding: 10px;
+	margin: 0px;
+}
+
+img {
+	border: 0px none;
+}
+
+a {
+	color: #000000;
+}
+
+#page {
+}
+
+#main {
+        min-height: 600px;
+        _height: 600px;
+
+}
+
+#left {
+        float: left;
+        width: 200px;
+	border: 1px solid #cccccc;
+}
+
+#content {
+	padding-top: 5px;
+        margin-left: 210px;
+}
+
+#header {
+	border: 1px solid #cccccc;
+	height: 100px;
+}
+
+#footer {
+        border: 1px solid #cccccc;
+        height: 50px;
+}
+
+.progress {
+	background: url(../img/indicator_white.gif) no-repeat 0 0;
+}

Added: branches/xmlconfig2/ajax/css/tree.css
===================================================================
--- branches/xmlconfig2/ajax/css/tree.css	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/css/tree.css	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,65 @@
+.treed, .treed ul {
+ list-style-type: none;
+ margin: 0;
+ padding: 0;
+ font-family: Tahoma, verdana, arial, sans-serif;
+ font-size: 12px;
+ background-image: url('../img/vdot.gif');
+ background-repeat: repeat-y;
+ background-position: 8px 0px;
+}
+.treed a {
+ text-decoration: none;
+ color: #000;
+ background-image: url('../img/folder.gif');
+ background-repeat: no-repeat;
+ background-position: center left;
+ padding: 2px 0 2px 20px;
+}
+.treed li {
+ padding-top: 4px;
+ padding-left: 20px;
+ background-image: url('../img/corner.gif');
+ background-repeat: no-repeat;
+ background-position: 8px 0px;
+}
+.treed a:hover {
+ text-decoration: underline;
+}
+.treed .collapsed, .treed .open {
+ background-repeat: no-repeat;
+ background-position: 4px 0px;
+ cursor: pointer;
+}
+.treed .collapsed {
+ background-image: url('../img/plus.gif');
+}
+.treed .open {
+ background-image: url('../img/minus.gif');
+}
+.treed .collapsed ul, .treed .lastcollapsed ul {
+ display: none;
+}
+.treed .last, .treed .lastfile {
+ background-image: url('../img/corner.gif');
+ background-position: 8px 0px;
+ background-color: #fff;
+}
+.treed .lastcollapsed {
+ background-image: url('../img/plus.gif');
+}
+.treed .lastopen {
+ background-image: url('../img/minus.gif');
+}
+.treed .lastopen, .treed .lastcollapsed {
+ background-repeat: no-repeat;
+ background-position: 4px 0px;
+ cursor: pointer;
+ background-color: #fff;
+}
+.treed .file a, .treed .lastfile a {
+ background-image: url('../img/file.gif');
+}
+.treed .file a[type='audio/x-ms-wma'], .treed .lastfile a[type='audio/x-ms-wma'] {
+ background-image: url('../img/wma.gif');
+}

Added: branches/xmlconfig2/ajax/detail.php
===================================================================
--- branches/xmlconfig2/ajax/detail.php	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/detail.php	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,49 @@
+&lt;?php
+/**
+ * $Id: detail.php 141 2006-07-03 11:14:33Z goliath $
+ *
+ * Author: David Danier, <A HREF="https://lists.berlios.de/mailman/listinfo/serverstats-devel">david.danier at team23.de</A>
+ * Project: Serverstats, <A HREF="http://serverstats.berlios.de/">http://serverstats.berlios.de/</A>
+ * License: GPL v2 or later (<A HREF="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</A>)
+ *
+ * Copyright (C) 2005 David Danier
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+// Load all needed classes, function and everything else
+require_once('../init.php');
+if (!isset($_GET['graph']))
+{
+	die('$_GET[&quot;graph&quot;] missing');
+}
+
+// Init Vars used in this script
+$graphindex = $_GET['graph'];
+$graph = $config['graph']['list'][$graphindex];
+
+?&gt;
+&lt;h1&gt;&lt;?php echo htmlspecialchars(lang::t('Statistics')); ?&gt; - &lt;?php echo htmlspecialchars($graph['title']); ?&gt;&lt;/h1&gt;
+&lt;?php
+
+// List all configured graphs
+foreach ($config['graph']['types'] as $graphtype)
+{
+	?&gt;
+	&lt;h2&gt;&lt;?php echo $graphtype['title']; ?&gt;&lt;/h2&gt;
+	&lt;img src=&quot;../graph.php?graph=&lt;?php echo $graphindex; ?&gt;&amp;start=&lt;?php echo -$graphtype['period']; ?&gt;&amp;title=&lt;?php echo htmlspecialchars($graphtype['title']); ?&gt;&quot; alt=&quot;&lt;?php echo htmlspecialchars($graphtype['title']); ?&gt;&quot; /&gt;
+	&lt;?php
+}
+?&gt;

Added: branches/xmlconfig2/ajax/graphs.php
===================================================================
--- branches/xmlconfig2/ajax/graphs.php	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/graphs.php	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,43 @@
+&lt;?php
+
+/**
+ * $Id: index.php 123 2006-04-11 12:35:34Z goliath $
+ *
+ * Author: David Danier, <A HREF="https://lists.berlios.de/mailman/listinfo/serverstats-devel">david.danier at team23.de</A>
+ * Project: Serverstats, <A HREF="http://serverstats.berlios.de/">http://serverstats.berlios.de/</A>
+ * License: GPL v2 or later (<A HREF="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</A>)
+ *
+ * Copyright (C) 2005 David Danier
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+// Load all needed classes, function and everything else
+require_once('../init.php');
+
+foreach ($config['graph']['list'] as $graphindex =&gt; $graph)
+{
+        if (isFiltered($graph, $filter))
+                continue;
+        ?&gt;
+        &lt;h2&gt;&lt;?php echo htmlspecialchars($graph['title']); ?&gt;&lt;/h2&gt;
+        &lt;a href=&quot;javascript:loadgraphs('detail.php?graph=&lt;?php echo htmlspecialchars($graphindex); ?&gt;&amp;tree=&lt;?php echo htmlspecialchars(currentTreePath($tree)); ?&gt;&amp;filter=&lt;?php echo htmlspecialchars(currentFilter($filter)); ?&gt;');&quot;&gt;
+        &lt;img src=&quot;../graph.php?graph=&lt;?php echo htmlspecialchars($graphindex); ?&gt;&quot; alt=&quot;&lt;?php echo htmlspecialchars($graph['title']); ?&gt;&quot; /&gt;
+        &lt;/a&gt;
+        &lt;?php
+}
+
+
+?&gt;

Added: branches/xmlconfig2/ajax/img/corner.gif
===================================================================
(Binary files differ)


Property changes on: branches/xmlconfig2/ajax/img/corner.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/xmlconfig2/ajax/img/file.gif
===================================================================
(Binary files differ)


Property changes on: branches/xmlconfig2/ajax/img/file.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/xmlconfig2/ajax/img/folder.gif
===================================================================
(Binary files differ)


Property changes on: branches/xmlconfig2/ajax/img/folder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/xmlconfig2/ajax/img/indicator_white.gif
===================================================================
(Binary files differ)


Property changes on: branches/xmlconfig2/ajax/img/indicator_white.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/xmlconfig2/ajax/img/minus.gif
===================================================================
(Binary files differ)


Property changes on: branches/xmlconfig2/ajax/img/minus.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/xmlconfig2/ajax/img/plus.gif
===================================================================
(Binary files differ)


Property changes on: branches/xmlconfig2/ajax/img/plus.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/xmlconfig2/ajax/img/vdot.gif
===================================================================
(Binary files differ)


Property changes on: branches/xmlconfig2/ajax/img/vdot.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/xmlconfig2/ajax/index.php
===================================================================
--- branches/xmlconfig2/ajax/index.php	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/index.php	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,97 @@
+&lt;?php
+/**
+ * $Id: index.php 123 2006-04-11 12:35:34Z goliath $
+ *
+ * Author: David Danier, <A HREF="https://lists.berlios.de/mailman/listinfo/serverstats-devel">david.danier at team23.de</A>
+ * Project: Serverstats, <A HREF="http://serverstats.berlios.de/">http://serverstats.berlios.de/</A>
+ * License: GPL v2 or later (<A HREF="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</A>)
+ *
+ * Copyright (C) 2005 David Danier
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ */
+
+// Load all needed classes, function and everything else
+require_once('../init.php');
+
+?&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt; 
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;de&quot;&gt;  
+&lt;head&gt;
+	&lt;title&gt;&lt;?php echo lang::t('Statistics'); ?&gt; - &lt;?php echo lang::t('Summary'); ?&gt;&lt;/title&gt;
+	&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;js/tree.js&quot;&gt;&lt;/script&gt;
+        &lt;script type=&quot;text/javascript&quot; src=&quot;js/xml.js&quot;&gt;&lt;/script&gt;
+        &lt;script type=&quot;text/javascript&quot; src=&quot;js/ajax.js&quot;&gt;&lt;/script&gt;
+	&lt;script type=&quot;text/javascript&quot; &gt;
+		function loadgraphs(url) {
+                        var myajax = new concentre.ajax(url,'get','');
+
+                        myajax.progressIndicator = function () {
+                                var content = document.getElementById('content');
+                                content.className = 'progress';
+                        }
+
+                        myajax.callBack = function () {
+
+                                var content = document.getElementById('content');
+                                content.className = '';
+                                content.innerHTML = this.http.responseText;
+
+                        }
+
+                        myajax.send();
+		}
+
+		window.onload = function () {
+			if (document.getElementById &amp;&amp; document.getElementsByTagName) {
+			  var uls = document.getElementsByTagName('ul');
+			  for (var i = 0; i &lt; uls.length; i++) {
+			   if (uls[i].className.indexOf('tree') != -1) {
+			    tree(uls[i]);
+			   }
+			  }
+ 			}
+
+			//loadgraphs ('home.php');
+		}
+
+		
+	&lt;/script&gt;
+	&lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; media=&quot;screen, projection&quot; /&gt;
+	&lt;link charset=&quot;utf-8&quot; href=&quot;css/tree.css&quot; media=&quot;screen&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
+&lt;/head&gt;
+&lt;body class=&quot;index&quot;&gt;
+&lt;div id=&quot;page&quot;&gt;
+&lt;div id=&quot;header&quot;&gt;
+&lt;h1&gt;&lt;?php echo lang::t('Statistics'); ?&gt; - &lt;?php echo lang::t('Summary'); ?&gt;&lt;/h1&gt;
+&lt;/div&gt;
+&lt;div id=&quot;main&quot;&gt;
+&lt;div id=&quot;left&quot;&gt;
+&lt;?php
+
+require_once('tree.php');
+
+?&gt;
+&lt;/div&gt;
+&lt;div id=&quot;content&quot;&gt;
+
+&lt;/div&gt;
+&lt;/div&gt;
+&lt;div id=&quot;footer&quot;&gt;
+serverstats v0.8, 2006
+&lt;/div&gt;
+&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;

Added: branches/xmlconfig2/ajax/js/ajax.js
===================================================================
--- branches/xmlconfig2/ajax/js/ajax.js	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/js/ajax.js	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,82 @@
+concentre = new Object();
+concentre.ajax = new Object();
+
+concentre.ajax = function(surl,method, vars) {
+	this.location = surl;
+	this.method = method;
+	this.vars = vars;
+};
+
+
+concentre.ajax.prototype.send = function() {
+	this.http = new XMLHttpRequest();
+	
+	var _self = this;
+	_self.http.onreadystatechange = function () {  _self.process();  };
+
+	this.httpTimer = setTimeout ( function () { _self.timeoutHandler(_self.http); }, 30000);
+	
+	this.http.open(this.method, this.location, true);
+	this.http.setRequestHeader(&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;); 
+	this.progressIndicator();
+	
+	this.http.send( this.serializeVariables() );
+};
+
+concentre.ajax.prototype.serializeVariables = function(node) {
+	var serialized='';
+	for (var i in this.vars) {
+		serialized+= i + '=' + escape(this.vars[i]) + '&amp;';
+	}
+
+	return serialized.substr(0,serialized.length-1);
+}
+
+concentre.ajax.prototype.process = function () {
+	switch (this.http.readyState) {
+		default:
+			
+			break;
+		case 3:
+       break; 
+	
+		case 4:
+			clearTimeout(this.httpTimer);
+
+			switch (this.http.status) {
+				
+				case 0:
+				case 200: // url retrivied
+				        this.callBack();
+					break;
+				default:
+						alert(this.http.status + ' ' + this.http.statusText);
+						
+			}
+		break;
+	}
+};
+
+concentre.ajax.prototype.callBack= function() {
+};
+
+concentre.ajax.prototype.progressIndicator= function() {
+};
+
+	
+concentre.ajax.prototype.timeoutHandler= function(o) {
+	 try {
+		 		switch (o.readyState)
+		 			{
+		 				case 1:
+		 				case 2:
+		 				case 3:
+		 					o.abort();
+		 					break;
+		 				case 4:
+		 				default:
+						break;		 						 				
+		
+		 			}
+			 } catch (err) {}
+};

Added: branches/xmlconfig2/ajax/js/tree.js
===================================================================
--- branches/xmlconfig2/ajax/js/tree.js	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/js/tree.js	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,64 @@
+function tree(el) {
+ var fullyOpen = false;
+ if (el.className.indexOf('fully-open') != -1) {
+  fullyOpen = true;
+ }
+ el.className = 'treed';
+ var lis = el.getElementsByTagName('li');
+ for (var i = 0; i &lt; lis.length; i++) {
+  var uls = lis[i].getElementsByTagName('ul');
+  if (uls.length &gt; 0) {
+   if (lis[i].className == 'open' || fullyOpen) {
+    uncollapse(lis[i]);
+   } else {
+    collapse(lis[i]);
+   }
+   lis[i].onmousedown = function(e) {
+    this.className = (this.className.substring(0, 4) == 'last' ? (this.className == 'lastopen' ? 'lastcollapsed' : 'lastopen') : (this.className == 'open' ? 'collapsed' : 'open'));
+    clicker(e);
+   }
+  } else {
+   lis[i].className = 'file';
+  }
+  if (!nextElement(lis[i])) {
+   lis[i].className = 'last' + lis[i].className;
+  }
+ }
+ var as = el.getElementsByTagName('a');
+ for (var i = 0; i &lt; as.length; i++) {
+  as[i].onmousedown = function(e) {
+   clicker(e);
+  }
+ }
+}
+function collapse(li) {
+ li.className = 'collapsed';
+}
+function uncollapse(li) {
+ li.className = 'open';
+}
+function nextElement (node) {
+ try {
+  do {
+   node = node.nextSibling;
+  } while (node.nodeType != 1);
+  return node;
+ } catch (e) {
+  return false;
+ }
+}
+function clicker(e) {
+ if (!e) var e = window.event;
+ e.cancelBubble = true;
+ if (e.stopPropagation) e.stopPropagation();
+}
+window.onload = function() {
+ if (document.getElementById &amp;&amp; document.getElementsByTagName) {
+  var uls = document.getElementsByTagName('ul');
+  for (var i = 0; i &lt; uls.length; i++) {
+   if (uls[i].className.indexOf('tree') != -1) {
+    tree(uls[i]);
+   }
+  }
+ }
+}
\ No newline at end of file

Added: branches/xmlconfig2/ajax/js/xml.js
===================================================================
--- branches/xmlconfig2/ajax/js/xml.js	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/js/xml.js	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,66 @@
+if (window.ActiveXObject) {
+
+_DOM_PROGID = pickRecentProgID([&quot;Msxml2.DOMDocument.5.0&quot;, &quot;Msxml2.DOMDocument.4.0&quot;, &quot;Msxml2.DOMDocument.3.0&quot;, &quot;MSXML2.DOMDocument&quot;,&quot;MSXML.DOMDocument&quot;, &quot;Microsoft.XMLDOM&quot;]);
+_XMLHTTP_PROGID = pickRecentProgID([&quot;Msxml2.XMLHTTP.5.0&quot;, &quot;Msxml2.XMLHTTP.4.0&quot;, &quot;MSXML2.XMLHTTP.3.0&quot;, &quot;MSXML2.XMLHTTP&quot;, &quot;Microsoft.XMLHTTP&quot;]);
+_THREADEDDOM_PROGID = pickRecentProgID([&quot;Msxml2.FreeThreadedDOMDocument.5.0&quot;, &quot;MSXML2.FreeThreadedDOMDocument.4.0&quot;, &quot;MSXML2.FreeThreadedDOMDocument.3.0&quot;]);
+_XSLTEMPLATE_PROGID = pickRecentProgID([&quot;Msxml2.XSLTemplate.5.0&quot;, &quot;Msxml2.XSLTemplate.4.0&quot;, &quot;MSXML2.XSLTemplate.3.0&quot;]);	
+
+_IS_MSXML_5 = _DOM_PROGID == 'Msxml2.DOMDocument.5.0';
+
+function pickRecentProgID(idList){
+  // found progID flag
+	while (idList.length &gt; 0) {
+			try {
+  		 	new ActiveXObject(idList[0]);	
+  		 	return idList[0];
+			} catch (e) {
+  			// Didn't work. Try the next program.
+  			idList.shift();
+			}
+	}
+ 	throw new Exception(&quot;Could not retreive a valid progID of Class&quot;);
+};
+
+function XMLHttpRequest(){
+    return new ActiveXObject(_XMLHTTP_PROGID);
+};
+
+function XSLTProcessor(){
+        this.template = new ActiveXObject(_XSLTEMPLATE_PROGID);
+        this.processor = null;
+};
+
+XSLTProcessor.prototype.importStylesheet = function(xslDoc){
+    // convert stylesheet to free threaded
+    var converted = new ActiveXObject(_THREADEDDOM_PROGID); 
+    converted.loadXML(xslDoc.xml);
+    
+    this.template.stylesheet = converted;
+    this.processor = this.template.createProcessor();
+    // (re)set default param values
+    this.paramsSet = new Array();
+};
+
+
+XSLTProcessor.prototype.transformToDocument = function(sourceDoc){
+    this.processor.input = sourceDoc;
+    var outDoc = new ActiveXObject(_THREADEDDOM_PROGID);
+    this.processor.output = outDoc; 
+    this.processor.transform();
+    return outDoc;
+};
+
+XSLTProcessor.prototype.transformToFragment = function (sourceDoc, asFragmentOfDoc) {
+		return this.transformToDocument(sourceDoc);
+}
+
+XSLTProcessor.prototype.setParameter = function(nsURI, name, value){
+    /* nsURI is optional but cannot be null */
+    if(nsURI){
+        this.processor.addParameter(name, value, nsURI);
+    }else{
+        this.processor.addParameter(name, value);
+    };
+};
+
+}

Added: branches/xmlconfig2/ajax/tree.php
===================================================================
--- branches/xmlconfig2/ajax/tree.php	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/tree.php	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,14 @@
+&lt;?php
+
+$xslt = new XSLTProcessor();
+$xml = new domDocument();
+$xml -&gt; load('tree.xml');
+
+$xsl = new domDocument();
+$xsl -&gt; load('tree.xsl');
+
+$xslt -&gt; importStylesheet($xsl);
+
+echo $xslt -&gt; transformToXml($xml);
+
+?&gt;

Added: branches/xmlconfig2/ajax/tree.xml
===================================================================
--- branches/xmlconfig2/ajax/tree.xml	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/tree.xml	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,10 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
+&lt;node xmlns=&quot;urn:serverstats&quot; xmlns:xi=&quot;<A HREF="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</A>&quot; xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;&gt;
+	&lt;title&gt;Zone 1&lt;/title&gt;
+	&lt;filter /&gt;
+	&lt;node&gt;
+		&lt;title&gt;Zone 2&lt;/title&gt;
+		&lt;filter /&gt;
+	&lt;/node&gt;
+&lt;/node&gt;
+

Added: branches/xmlconfig2/ajax/tree.xsl
===================================================================
--- branches/xmlconfig2/ajax/tree.xsl	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/ajax/tree.xsl	2006-07-03 19:21:03 UTC (rev 152)
@@ -0,0 +1,29 @@
+&lt;xsl:stylesheet xmlns:xsl=&quot;<A HREF="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</A>&quot; version=&quot;1.0&quot; xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xmlns:xhtml=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xmlns:xf=&quot;<A HREF="http://www.w3.org/2002/xforms">http://www.w3.org/2002/xforms</A>&quot; xmlns:xi=&quot;<A HREF="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</A>&quot; xmlns:stats=&quot;urn:serverstats&quot; exclude-result-prefixes=&quot;xhtml xi xf stats&quot;&gt;
+&lt;xsl:output method=&quot;xml&quot; omit-xml-declaration=&quot;yes&quot; indent=&quot;yes&quot; encoding=&quot;utf-8&quot; version=&quot;1.0&quot; /&gt;
+&lt;xsl:strip-space elements=&quot;*&quot; /&gt;
+&lt;xsl:param name=&quot;modulepath&quot; /&gt;
+&lt;xsl:template match=&quot;@*|*|text()&quot;&gt;
+        &lt;xsl:copy-of select=&quot;.&quot; /&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template match=&quot;*&quot; /&gt;
+
+&lt;xsl:template match=&quot;/&quot;&gt;
+	&lt;ul id=&quot;tree&quot; class=&quot;tree&quot; xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;&gt;
+		&lt;xsl:apply-templates/&gt;
+		&lt;li&gt;&lt;a href=&quot;javascript:loadgraphs('graphs.php?filter=impact:important');&quot;&gt;Important&lt;/a&gt;&lt;/li&gt;
+		&lt;li&gt;&lt;a href=&quot;javascript:loadgraphs('graphs.php?filter=impact:critical');&quot;&gt;Critical&lt;/a&gt;&lt;/li&gt;
+	&lt;/ul&gt;	
+&lt;/xsl:template&gt;
+
+&lt;xsl:template match=&quot;stats:node&quot;&gt;
+        &lt;li&gt;&lt;a href=&quot;javascript:loadgraphs('graphs.php?filter={stats:filter}');&quot; class=&quot;file&quot;&gt;&lt;xsl:value-of select=&quot;stats:title&quot; /&gt;&lt;/a&gt;
+	&lt;xsl:if test=&quot;stats:node&quot;&gt;
+	&lt;ul&gt;
+		&lt;xsl:apply-templates/&gt;
+        &lt;/ul&gt;
+	&lt;/xsl:if&gt;
+	&lt;/li&gt;
+&lt;/xsl:template&gt;
+
+&lt;/xsl:stylesheet&gt;

Modified: branches/xmlconfig2/config.sample/graph.php
===================================================================
--- branches/xmlconfig2/config.sample/graph.php	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/config.sample/graph.php	2006-07-03 19:21:03 UTC (rev 152)
@@ -42,12 +42,26 @@
 		array(
 			'title' =&gt; 'localhost',
 			'filter' =&gt; 'host:localhost'
-		)
+		),
+		array ( 
+			'title' =&gt; 'important',
+			'filter' =&gt; 'impact:important'
+		),
+		array ( 
+			'title' =&gt; 'datacenter1',
+			'sub' =&gt; array (
+				array ( 
+					'title' =&gt; 'switches',
+					'filter' =&gt; 'groupby:switches1'
+					
+				)
+			)
+		)	
 	)
 );
 
 // Add own graphs (examples, like those used in the simple-config)
-/*
+
 $config['list'][] = array(
 	'title' =&gt; 'Users logged in',
 	'lowerLimit' =&gt; 0,
@@ -67,6 +81,11 @@
 	'title' =&gt; 'Load',
 	'lowerLimit' =&gt; 0,
 	'altAutoscaleMax' =&gt; true,
+	'categories' =&gt; array (
+		'host'=&gt; '127.0.0.1',
+		'impact' =&gt; 'important',
+		'groupby' =&gt; 'switches1'
+	),
 	'content' =&gt; array(
 		array(
 			'type' =&gt; 'COMMENT',
@@ -506,8 +525,8 @@
 		)
 	)
 );
-*/
 
+
 // Define what Graphes we want in the detail view (detail.php)
 $config['types'] = array(
 //	array('title' =&gt; 'Hour', 'period' =&gt; 3600), // only useful if you have a small step

Modified: branches/xmlconfig2/config.sample/sources.php
===================================================================
--- branches/xmlconfig2/config.sample/sources.php	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/config.sample/sources.php	2006-07-03 19:21:03 UTC (rev 152)
@@ -28,6 +28,7 @@
 // Add sources using the simple configuration
 // (To change what sources are used by simpleconfig please edit simple.php)
 simpleconfig::sources($config, $rootConfig['simple']);
+xmlconfig::sources($config, $rootConfig['xml']);
 
 // Add own sources (examples, like those used in the simple-config)
 /*

Modified: branches/xmlconfig2/init.php
===================================================================
--- branches/xmlconfig2/init.php	2006-07-03 19:18:52 UTC (rev 151)
+++ branches/xmlconfig2/init.php	2006-07-03 19:21:03 UTC (rev 152)
@@ -34,7 +34,7 @@
 define('CACHEPATH', PATH . 'cache' . DIRECTORY_SEPARATOR);
 define('RRDPATH', PATH . 'rrd' . DIRECTORY_SEPARATOR);
 define('LANGPATH', PATH . 'lang' . DIRECTORY_SEPARATOR);
-define('CONFIGPATH', PATH . 'config' . DIRECTORY_SEPARATOR);
+define('CONFIGPATH', PATH . 'config.sample' . DIRECTORY_SEPARATOR);
 
 // Load all needed functions
 require_once(INCLUDEPATH . 'functions.php');


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000112.html">[Serverstats-devel] r151 - branches
</A></li>
	<LI>Next message: <A HREF="000114.html">[Serverstats-devel] r153 - in branches/xmlconfig/config.sample/xml: . templates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#113">[ date ]</a>
              <a href="thread.html#113">[ thread ]</a>
              <a href="subject.html#113">[ subject ]</a>
              <a href="author.html#113">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/serverstats-devel">More information about the Serverstats-devel
mailing list</a><br>
</body></html>
